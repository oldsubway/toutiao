(function(){"use strict";var t={9811:function(t,e,n){n.d(e,{Z:function(){return d}});n(7658);var a=function(){var t=this,e=t._self._c;return t.article.cover?e("div",{on:{click:function(e){return t.$router.push("/article/"+t.article.art_id)}}},[e("van-cell",{scopedSlots:t._u([{key:"title",fn:function(){return[e("div",{staticClass:"title-box"},[e("span",[t._v(t._s(t.article.title))]),1===t.article.cover.type?e("img",{staticClass:"thumb",attrs:{src:n(6949),alt:""}}):t._e()]),3===t.article.cover.type?e("div",{staticClass:"thumb-box"},t._l(t.article.cover.images,(function(t,a){return e("img",{key:a,staticClass:"thumb",attrs:{src:n(6949),alt:""}})})),0):t._e()]},proxy:!0},{key:"label",fn:function(){return[e("div",{staticClass:"label-box"},[e("span",[t._v(t._s(t.article.aut_name)+"    "+t._s(t.article.comm_count)+"评论    "+t._s(t._f("dateFormat")(t.article.pubdate)))]),t.closeAble?e("van-icon",{attrs:{name:"cross"},on:{click:function(e){e.stopPropagation(),t.show=!0}}}):t._e()],1)]},proxy:!0}],null,!1,4029343292)}),e("van-action-sheet",{attrs:{"cancel-text":"取消",closeable:!1,"get-container":"body"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t.isFirst?e("div",t._l(t.actions,(function(n,a){return e("van-cell",{key:a,attrs:{title:n.name,"title-class":"center-title",clickable:""},on:{click:function(e){return t.onCellClick(n.name)}}})})),1):e("div",[e("van-cell",{attrs:{title:"返回",clickable:"","title-class":"center-title"},on:{click:function(e){t.isFirst=!0}}}),t._l(t.reports,(function(n,a){return e("van-cell",{key:a,attrs:{title:n.label,"title-class":"center-title"},on:{click:function(e){return t.reportArticle()}}})}))],2)])],1):t._e()},o=[];const i=[{type:0,label:"其它问题"},{type:1,label:"标题夸张"},{type:2,label:"低俗色情"},{type:3,label:"错别字多"},{type:4,label:"旧闻重复"},{type:6,label:"内容不实"},{type:8,label:"侵权"},{type:5,label:"广告软文"},{type:7,label:"涉嫌违法犯罪"}];var r=i,s={name:"ArtItem",props:{article:{required:!0,type:Object},closeAble:{type:Boolean,default:!0}},data(){return{show:!1,actions:[{name:"不感兴趣"},{name:"反馈垃圾内容"},{name:"拉黑作者"}],isFirst:!0,reports:r}},created(){},methods:{onCellClick(t){switch(t){case"不感兴趣":this.show=!1,this.$emit("remove-article",this.article.art_id);break;case"拉黑作者":this.show=!1;break;case"反馈垃圾内容":this.isFirst=!1;break}},reportArticle(){this.$emit("remove-article",this.article.art_id),this.show=!1,this.isFirst=!0}}},c=s,l=n(1001),u=(0,l.Z)(c,a,o,!1,null,"36b9623e",null),d=u.exports},5212:function(t,e,n){n.d(e,{E5:function(){return c},TY:function(){return r},UO:function(){return o},Zf:function(){return i},r0:function(){return s}});var a=n(4471);const o=()=>{const t={projection:{token:1,refresh_token:1,_id:0},collection:"user"};return a.Z.post("/action/findOne",t)},i=()=>{const t={projection:{name:1,art_count:1,photo:1,follow_count:1,fans_count:1,_id:0},collection:"user"};return a.Z.post("/action/findOne",t)},r=()=>{const t={projection:{name:1,birthday:1,photo:1,_id:0},collection:"user"};return a.Z.post("/action/findOne",t)},s=t=>{const e={update:{$set:t},collection:"user"};return a.Z.post("/action/updateOne",e)},c=t=>{const e={update:{$set:t},collection:"user"};return a.Z.post("/action/updateOne",e)}},8113:function(t,e,n){var a=n(6369),o=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("keep-alive",[e("router-view")],1)],1)},i=[],r={name:"App"},s=r,c=n(1001),l=(0,c.Z)(s,o,i,!1,null,"455cce1d",null),u=l.exports,d=n(2631),f=n(4239),h=(n(7658),function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-container"},[e("van-nav-bar",{attrs:{"left-arrow":"",title:"黑马头条 - 登录",fixed:""},on:{"click-left":function(e){return t.$router.push("/")}}}),e("van-form",{on:{submit:t.login}},[e("van-field",{attrs:{label:"手机号",maxlength:"11",type:"tel",name:"mobile",placeholder:"请输入手机号",rules:t.rules.mobile},model:{value:t.form.mobile,callback:function(e){t.$set(t.form,"mobile",e)},expression:"form.mobile"}}),e("van-field",{attrs:{label:"密码",type:"password",name:"code",placeholder:"请输入密码",rules:t.rules.code},model:{value:t.form.code,callback:function(e){t.$set(t.form,"code",e)},expression:"form.code"}}),e("div",{staticStyle:{margin:"16px"}},[e("van-button",{attrs:{round:"",block:"",type:"info","native-type":"submit"}},[t._v("提交")])],1)],1)],1)}),p=[],m=n(5212),v=n(3822),b={name:"LoginView",data(){return{form:{mobile:"13633987732",code:"12345678"},rules:{mobile:[{required:!0,message:"请输入您的手机号",trigger:"onBlur"},{pattern:/1\d{10}/,message:"请输入正确的手机号",trigger:"onBlur"}],code:[{required:!0,message:"请输入您的密码",trigger:"onBlur"}]}}},methods:{...(0,v.OI)(["updateTokenInfo"]),async login(){const{data:t}=await(0,m.UO)();this.updateTokenInfo(t.document);const e=this.$route.query.pre||"/";this.$router.replace(e)}}},g=b,y=(0,c.Z)(g,h,p,!1,null,"17b94380",null),k=y.exports,C=function(){var t=this,e=t._self._c;return e("div",[e("keep-alive",[e("router-view")],1),e("van-tabbar",{attrs:{route:""}},[e("van-tabbar-item",{attrs:{name:"home",icon:"home-o",to:{name:"home"}}},[t._v("主页 ")]),e("van-tabbar-item",{attrs:{name:"user",icon:"user-o",to:{name:"user"}}},[t._v("我的")])],1)],1)},_=[],w={name:"MainView"},x=w,Z=(0,c.Z)(x,C,_,!1,null,"64a763dc",null),S=Z.exports,L=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"home-container"},[e("van-nav-bar",{attrs:{fixed:"",title:"黑马头条"},scopedSlots:t._u([{key:"left",fn:function(){return[e("img",{staticClass:"logo",attrs:{src:n(4068)}})]},proxy:!0},{key:"right",fn:function(){return[e("van-icon",{attrs:{name:"search",color:"white",size:"18"},on:{click:function(e){return t.$router.push("/search")}}})]},proxy:!0}])}),e("van-tabs",{attrs:{sticky:"","offset-top":"46px","before-change":t.beforeTabsChange},on:{change:t.onTabsChange},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},t._l(t.userChannel,(function(t){return e("van-tab",{key:t.id,attrs:{title:t.name}},[e("art-list",{attrs:{channelId:t.id}})],1)})),1),e("van-icon",{staticClass:"plus",attrs:{name:"plus",size:"16"},on:{click:function(e){t.show=!0}}}),e("van-popup",{attrs:{"close-on-click-overlay":!1},on:{closed:function(e){t.isDel=!1}},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[e("div",{staticClass:"popup-container"},[e("van-nav-bar",{attrs:{title:"频道管理"},scopedSlots:t._u([{key:"right",fn:function(){return[e("van-icon",{attrs:{name:"cross",size:"14",color:"white"},on:{click:function(e){t.show=!1}}})]},proxy:!0}])}),e("div",{staticClass:"pop-body"},[e("div",{staticClass:"my-channel-box"},[e("div",{staticClass:"channel-title"},[e("div",[e("span",{staticClass:"title-bold"},[t._v("已添加频道：")]),e("span",{staticClass:"title-gray"},[t._v(t._s(t.isDel?"点击移除频道":"点击进入频道"))])]),e("span",{staticClass:"btn-edit",on:{click:function(e){t.isDel=!t.isDel}}},[t._v(t._s(t.isDel?"完成":"编辑"))])]),e("van-row",{attrs:{type:"flex"}},t._l(t.userChannel,(function(n,a){return e("van-col",{key:n.id,attrs:{span:"6"}},[e("div",{staticClass:"channel-item van-hairline--surround",on:{click:function(e){return t.onUserChannelClick(n,a)}}},[t._v(" "+t._s(n.name)+" "),t.isDel&&"首页"!==n.name?e("van-badge",{staticClass:"cross-badge",attrs:{color:"transparent"},scopedSlots:t._u([{key:"content",fn:function(){return[e("van-icon",{staticClass:"badge-icon",attrs:{name:"cross",color:"red",size:"12"}})]},proxy:!0}],null,!0)}):t._e()],1)])})),1)],1),e("div",{staticClass:"van-hairline--top sp-line"}),e("div",{staticClass:"more-channel-box"},[e("div",{staticClass:"channel-title"},[e("div",[e("span",{staticClass:"title-bold"},[t._v("可添加频道：")]),e("span",{staticClass:"title-gray"},[t._v("点击添加频道")])])]),e("van-row",{attrs:{type:"flex"}},t._l(t.moreChannel,(function(n){return e("van-col",{key:n.id,attrs:{span:"6"},on:{click:function(e){return t.addChannel(n)}}},[e("div",{staticClass:"channel-item van-hairline--surround"},[t._v(t._s(n.name))])])})),1)],1)])],1)])],1)])},P=[],O=n(4471);const A=(t={})=>(t={projection:{channels:1,_id:0},collection:"user"},O.Z.post("/action/findOne",t)),T=t=>{const e={skip:0+10*t,limit:10,sort:{art_id:1},projection:{_id:0},collection:"articles"};return O.Z.post("/action/find",e)},I=(t={})=>(t={projection:{_id:0},collection:"channels"},O.Z.post("/action/find",t)),j=(t={})=>(t={update:{$set:{channels:t}},collection:"user"},O.Z.post("/action/updateOne",t));var $=function(){var t=this,e=t._self._c;return e("div",{staticClass:"artlist-container"},[e("van-pull-refresh",{attrs:{disabled:t.finished},on:{refresh:t.onRefresh},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了","immediate-check":!1},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.artList,(function(n){return e("art-item",{key:n.art_id,attrs:{article:n},on:{"remove-article":t.removeArticle}})})),1)],1)],1)},U=[],E=n(9811),F={name:"ArtList",components:{ArtItem:E.Z},props:{channelId:{required:!0,type:Number}},data(){return{artList:[],loading:!1,finished:!1,page:1,isLoading:!1}},created(){this.initArtList()},methods:{async initArtList(t){const{data:e}=await T(this.page,this.channelId);t?(this.artList=[...e.documents,...this.artList],this.isLoading=!1):(this.artList=[...this.artList,...e.documents],this.loading=!1),0===e.documents.length&&(this.finished=!0),this.page+=1},onLoad(){this.initArtList()},onRefresh(){this.initArtList(!0)},removeArticle(t){this.artList=this.artList.filter((e=>e.art_id!==t)),this.artList.length<6&&this.initArtList()}}},N=F,D=(0,c.Z)(N,$,U,!1,null,null,null),R=D.exports;const q={};var B={name:"HomeView",components:{ArtList:R},data(){return{active:0,userChannel:[],show:!1,allChannel:[],isDel:!1}},computed:{moreChannel(){return this.allChannel.filter((t=>{const e=this.userChannel.findIndex((e=>e.id===t.id));return-1===e}))}},created(){this.initUserChannel(),this.initAllChannel()},beforeRouteLeave(t,e,n){e.meta.top=window.scrollY,n()},methods:{async initUserChannel(){const{data:t}=await A();this.userChannel=t.document.channels},async initAllChannel(){const{data:t}=await I();this.allChannel=t.documents},addChannel(t){this.userChannel.push(t),this.updateChannel()},async updateChannel(){const t=this.userChannel.filter((t=>"首页"!==t.name)).map((t=>({id:t.id,name:t.name})));await j(t),this.$notify({type:"success",message:"更新成功",duration:1e3})},onUserChannelClick(t,e){if(this.isDel){if("首页"===t.name||2===this.userChannel.length)return;this.userChannel=this.userChannel.filter((e=>e.id!==t.id)),this.updateChannel()}else this.active=e,this.show=!1},beforeTabsChange(){const t=this.userChannel[this.active].name;return q[t]=window.scrollY,!0},onTabsChange(){this.$nextTick((()=>{const t=this.userChannel[this.active].name;window.scrollTo(0,q[t]||0)}))}}},z=B,M=(0,c.Z)(z,L,P,!1,null,"3fe34832",null),Y=M.exports;a.ZP.use(d.ZP);const J=[{path:"/login",component:k,name:"login"},{path:"/",component:S,redirect:"/",children:[{path:"",name:"home",component:Y,meta:{isRecord:!0,top:0}},{path:"user",name:"user",component:()=>n.e(968).then(n.bind(n,7968))}]},{path:"/search",name:"search",component:()=>n.e(963).then(n.bind(n,7963))},{path:"/search/:kw",name:"search-result",component:()=>n.e(296).then(n.bind(n,5799)),props:!0,meta:{isRecord:!0,top:0}},{path:"/article/:id",name:"art-detail",component:()=>n.e(281).then(n.bind(n,7281)),props:!0,meta:{isRecord:!0,top:0}},{path:"/user/edit",name:"user-edit",component:()=>n.e(538).then(n.bind(n,538))},{path:"/chat",name:"chat",component:()=>n.e(887).then(n.bind(n,1887))},{path:"*",redirect:"/"}],H=new d.ZP({mode:"hash",base:"/toutiao/",routes:J}),V=["/user","/user/edit"],G=d.ZP.prototype.push;d.ZP.prototype.push=function(t,e,n){return e||n?G.call(this,t,e,n):G.call(this,t).catch((t=>t))},H.beforeEach(((t,e,n)=>{if(V.includes(t.path)){const e=f.Z.state.tokenInfo.token;e?n():n(`/login?pre=${t.fullPath}`)}else n()})),H.afterEach(((t,e,n)=>{t.meta.isRecord&&setTimeout((()=>{window.scrollTo(0,t.meta.top)}),0)}));var K=H,Q=n(2304),W=n(1878),X=(n(8132),n(5743)),tt=n.n(X),et=n(893),nt=n.n(et),at=n(8212),ot=n.n(at);tt().extend(nt()),tt().locale(ot()),a.ZP.filter("dateFormat",(t=>tt()().to(t))),a.ZP.use(Q.ZP),a.ZP.use(W.Z),a.ZP.config.productionTip=!1,new a.ZP({router:K,store:f.Z,render:t=>t(u)}).$mount("#app")},4239:function(t,e,n){var a=n(6369),o=n(3822),i=n(5212);a.ZP.use(o.ZP);let r={tokenInfo:{},userInfo:{},userProfile:{}};const s=localStorage.getItem("state");s&&(r=JSON.parse(s)),e["Z"]=new o.ZP.Store({state:r,getters:{userAvatar(t){let e="https://img.yzcdn.cn/vant/cat.jpeg";return t.userInfo.photo&&(e=t.userInfo.photo),e}},mutations:{updateTokenInfo(t,e){t.tokenInfo=e,this.commit("saveStateToStorage")},saveStateToStorage(t){localStorage.setItem("state",JSON.stringify(t))},updateUserInfo(t,e){t.userInfo=e,this.commit("saveStateToStorage")},cleanState(t){t.tokenInfo={},t.userInfo={},this.commit("saveStateToStorage")},updateUserProfile(t,e){t.userProfile=e,this.commit("saveStateToStorage")}},actions:{async initUserInfo(t){const{data:e}=await(0,i.Zf)();t.commit("updateUserInfo",e.document)},async initUserProfile(t){const{data:e}=await(0,i.TY)();console.log(e),t.commit("updateUserProfile",e.document)}},modules:{}})},4471:function(t,e,n){var a=n(4311),o=n(8848),i=n(4239);const r={database:"toutiao",dataSource:"oldsubway"},s=a.Z.create({headers:{"Content-Type":"application/json","api-key":"DRUUIQaJGPfI007vZ57uczcRhio5Y3NGoK0OFHt7dOxApbdoaMJh56jMo3jLQR3S"}});s.interceptors.request.use((t=>{o.Z.loading({message:"加载中....",duration:0});const e=i.Z.state.tokenInfo.token;return e&&"user"===t.data.collection&&(t.data.filter={token:e}),t.data={...t.data,...r},t}),(t=>(o.Z.clear(),Promise.reject(t)))),s.interceptors.response.use((t=>(o.Z.clear(),t)),(t=>(o.Z.clear(),Promise.reject(t)))),e["Z"]=s},4068:function(t,e,n){t.exports=n.p+"img/header.784f6aa0.png"},6949:function(t,e,n){t.exports=n.p+"img/logo.4c31ca9c.png"}},e={};function n(a){var o=e[a];if(void 0!==o)return o.exports;var i=e[a]={exports:{}};return t[a].call(i.exports,i,i.exports,n),i.exports}n.m=t,function(){var t=[];n.O=function(e,a,o,i){if(!a){var r=1/0;for(u=0;u<t.length;u++){a=t[u][0],o=t[u][1],i=t[u][2];for(var s=!0,c=0;c<a.length;c++)(!1&i||r>=i)&&Object.keys(n.O).every((function(t){return n.O[t](a[c])}))?a.splice(c--,1):(s=!1,i<r&&(r=i));if(s){t.splice(u--,1);var l=o();void 0!==l&&(e=l)}}return e}i=i||0;for(var u=t.length;u>0&&t[u-1][2]>i;u--)t[u]=t[u-1];t[u]=[a,o,i]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var a in e)n.o(e,a)&&!n.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){n.f={},n.e=function(t){return Promise.all(Object.keys(n.f).reduce((function(e,a){return n.f[a](t,e),e}),[]))}}(),function(){n.u=function(t){return"js/"+t+"."+{281:"f7ecf35b",296:"0ac13162",538:"2700ba64",887:"edea2537",963:"6f55356d",968:"03451a40"}[t]+".js"}}(),function(){n.miniCssF=function(t){return"css/"+t+"."+{281:"7037e92e",296:"554a9315",538:"2e0120ba",887:"a79aa814",963:"2a4cb5ce",968:"db16fdeb"}[t]+".css"}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={},e="toutiao:";n.l=function(a,o,i,r){if(t[a])t[a].push(o);else{var s,c;if(void 0!==i)for(var l=document.getElementsByTagName("script"),u=0;u<l.length;u++){var d=l[u];if(d.getAttribute("src")==a||d.getAttribute("data-webpack")==e+i){s=d;break}}s||(c=!0,s=document.createElement("script"),s.charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",e+i),s.src=a),t[a]=[o];var f=function(e,n){s.onerror=s.onload=null,clearTimeout(h);var o=t[a];if(delete t[a],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach((function(t){return t(n)})),e)return e(n)},h=setTimeout(f.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=f.bind(null,s.onerror),s.onload=f.bind(null,s.onload),c&&document.head.appendChild(s)}}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){n.p="/toutiao/"}(),function(){if("undefined"!==typeof document){var t=function(t,e,n,a,o){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css";var r=function(n){if(i.onerror=i.onload=null,"load"===n.type)a();else{var r=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.href||e,c=new Error("Loading CSS chunk "+t+" failed.\n("+s+")");c.code="CSS_CHUNK_LOAD_FAILED",c.type=r,c.request=s,i.parentNode.removeChild(i),o(c)}};return i.onerror=i.onload=r,i.href=e,n?n.parentNode.insertBefore(i,n.nextSibling):document.head.appendChild(i),i},e=function(t,e){for(var n=document.getElementsByTagName("link"),a=0;a<n.length;a++){var o=n[a],i=o.getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(i===t||i===e))return o}var r=document.getElementsByTagName("style");for(a=0;a<r.length;a++){o=r[a],i=o.getAttribute("data-href");if(i===t||i===e)return o}},a=function(a){return new Promise((function(o,i){var r=n.miniCssF(a),s=n.p+r;if(e(r,s))return o();t(a,s,null,o,i)}))},o={143:0};n.f.miniCss=function(t,e){var n={281:1,296:1,538:1,887:1,963:1,968:1};o[t]?e.push(o[t]):0!==o[t]&&n[t]&&e.push(o[t]=a(t).then((function(){o[t]=0}),(function(e){throw delete o[t],e})))}}}(),function(){var t={143:0};n.f.j=function(e,a){var o=n.o(t,e)?t[e]:void 0;if(0!==o)if(o)a.push(o[2]);else{var i=new Promise((function(n,a){o=t[e]=[n,a]}));a.push(o[2]=i);var r=n.p+n.u(e),s=new Error,c=function(a){if(n.o(t,e)&&(o=t[e],0!==o&&(t[e]=void 0),o)){var i=a&&("load"===a.type?"missing":a.type),r=a&&a.target&&a.target.src;s.message="Loading chunk "+e+" failed.\n("+i+": "+r+")",s.name="ChunkLoadError",s.type=i,s.request=r,o[1](s)}};n.l(r,c,"chunk-"+e,e)}},n.O.j=function(e){return 0===t[e]};var e=function(e,a){var o,i,r=a[0],s=a[1],c=a[2],l=0;if(r.some((function(e){return 0!==t[e]}))){for(o in s)n.o(s,o)&&(n.m[o]=s[o]);if(c)var u=c(n)}for(e&&e(a);l<r.length;l++)i=r[l],n.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return n.O(u)},a=self["webpackChunktoutiao"]=self["webpackChunktoutiao"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=n.O(void 0,[998],(function(){return n(8113)}));a=n.O(a)})();
//# sourceMappingURL=app.9a37554a.js.map